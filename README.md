# SSAU Room Schedule Bot

Телеграм-бот для просмотра расписания и поиска свободных аудиторий в СГАУ.

## Возможности

- Просмотр расписания конкретной аудитории на выбранную дату
- Поиск свободных аудиторий в выбранном корпусе на определенное время
- Поиск свободных аудиторий на несколько пар подряд
- Административная панель для отправки уведомлений всем пользователям
- Статистика использования бота
- Управление пользовательскими настройками

## Установка и настройка

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка переменных окружения

1. Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```

2. Отредактируйте файл `.env`, указав:
   - `BOT_TOKEN` - токен вашего бота, полученный от @BotFather
   - `ADMIN_IDS` - ID администраторов бота, разделенные запятыми
   - `SESSION_ID` - сессионный ID для парсера расписания

### Получение данных расписания

Для первоначального получения данных о занятых аудиториях запустите:

```bash
python get_db.py
```

Это создаст файл `occupied_rooms.json` с данными о расписании аудиторий.

## Запуск бота

```bash
python tg_bot.py
```

## Команды бота

- `/start` - Начать работу с ботом
- `/menu` - Показать главное меню
- `/help` - Справка по использованию
- `/settings` - Настройки пользователя
- `/commands` - Список доступных команд
- `/admin` - Панель администратора (только для админов)
- `/cancel` - Отменить текущую операцию

## Структура проекта

- `tg_bot.py` - Основной файл бота
- `db_model.py` - Модель для работы с базой данных пользователей
- `get_db.py` - Скрипт для получения данных о расписании
- `occupied_rooms.json` - Файл с данными о занятых аудиториях
- `bot_data.db` - SQLite база данных с информацией о пользователях и уведомлениях

## База данных

Бот использует SQLite для хранения информации о пользователях и уведомлениях. База данных создается автоматически при первом запуске.

### Таблицы:

1. `users` - Информация о пользователях
   - `user_id` - ID пользователя Telegram
   - `username` - Имя пользователя
   - `first_name` - Имя
   - `last_name` - Фамилия
   - `is_admin` - Флаг администратора
   - `joined_date` - Дата первого использования бота
   - `last_activity` - Дата последней активности
   - `notifications_enabled` - Флаг включенных уведомлений

2. `notifications` - История отправленных уведомлений
   - `id` - ID уведомления
   - `text` - Текст уведомления
   - `created_at` - Дата создания
   - `created_by` - ID создателя (администратора)
   - `is_sent` - Флаг отправки

## Для разработчиков

### Добавление новых функций

1. Определите новое состояние в блоке констант `ConversationHandler`
2. Создайте обработчики для нового состояния
3. Добавьте новые обработчики в `states` конструктора `ConversationHandler`

### Обновление расписания

Для обновления данных о расписании периодически запускайте скрипт `get_db.py`.
Рекомендуется настроить автоматический запуск через cron или другой планировщик задач.